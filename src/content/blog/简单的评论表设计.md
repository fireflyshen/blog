---
author: firefly
pubDatetime: 2022-09-23T15:22:00Z
modDatetime: 2023-12-21T09:12:47.400Z
title: ç®€å•çš„è¯„è®ºè¡¨çš„è®¾è®¡
slug: comment-table-design
featured: false
draft: false
tags:
  - comments
  - SQL
description: " "
---

ç›®å‰çš„è¯„è®ºç³»ç»Ÿå¤§å¤šå…¶å®éƒ½æ˜¯äºŒçº§è¯„è®ºï¼Œç›–æ¥¼çš„é‚£ç§åŸºæœ¬æ²¡æœ‰äº†ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯åµŒå¥—å±‚çº§çš„é‚£ç§ï¼Œæ¯”å¦‚radditçš„è¯„è®ºå°±æ˜¯è¿™ä¸ªï¼Œä½†æ˜¯å‘¢ï¼Œè‚¯å®šä¹Ÿæ˜¯ä¸èƒ½çš„æ— é™åµŒå¥—çš„ï¼Œä¸ç„¶æ²¡æœ‰åŠæ³•æ˜¾ç¤ºï¼Œå¦‚æœæˆ‘ğŸ˜¯æ²¡æœ‰è®°é”™çš„è¯åº”è¯¥æ˜¯åå±‚ï¼Œå¦‚æœè¶…è¿‡åå±‚å¯èƒ½è¦æ‰“å¼€æ–°çš„é¡µé¢æ¥æ˜¾ç¤ºï¼Œä¸è¿‡åŸºæœ¬ä¸Šå¾ˆå°‘æœ‰è¶…è¿‡5å±‚çš„å›å¤ï¼Œ

é¦–å…ˆå…ˆæ¥è®²ï¼ŒäºŒçº§å›å¤ï¼Œè¿™ç§å½¢å¼çš„ç»“æ„æ˜¯å¦‚ä¸‹è¿™æ ·çš„(ä¸€ä¸ªé™æ€é¡µé¢)

<div style="font-family: Arial, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; background-color: #f0f0f0; padding: 20px;">
  <div style="background-color: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 10px;">
    <div style="margin-bottom: 5px;">è¿™æ˜¯ç¬¬ä¸€ä¸ªä¸»è¯„è®ºã€‚</div>
    <div style="font-size: 0.8em; color: #666;">ç”¨æˆ·1 Â· 2å°æ—¶å‰ | å›å¤</div>
    <div style="margin-left: 20px; border-left: 2px solid #ddd; padding-left: 10px;">
      <div style="background-color: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-top: 10px;">
        <div style="margin-bottom: 5px;">è¿™æ˜¯å¯¹ä¸»è¯„è®º1çš„ç›´æ¥å›å¤ã€‚</div>
        <div style="font-size: 0.8em; color: #666;">ç”¨æˆ·2 Â· 1å°æ—¶å‰ | å›å¤</div>
      </div>
      <div style="background-color: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-top: 10px;">
        <div style="margin-bottom: 5px;">è¿™æ˜¯å¯¹ä¸»è¯„è®º1çš„å¦ä¸€ä¸ªç›´æ¥å›å¤ã€‚</div>
        <div style="font-size: 0.8em; color: #666;">ç”¨æˆ·3 Â· 30åˆ†é’Ÿå‰ | å›å¤</div>
      </div>
      <div style="color: #0066cc; cursor: pointer; margin-top: 5px;">åŠ è½½æ›´å¤šå›å¤...</div>
    </div>
  </div>
  
  <div style="background-color: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 10px;">
    <div style="margin-bottom: 5px;">è¿™æ˜¯ç¬¬äºŒä¸ªä¸»è¯„è®ºã€‚</div>
    <div style="font-size: 0.8em; color: #666;">ç”¨æˆ·4 Â· 3å°æ—¶å‰ | å›å¤</div>
    <div style="margin-left: 20px; border-left: 2px solid #ddd; padding-left: 10px;">
      <div style="background-color: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-top: 10px;">
        <div style="margin-bottom: 5px;">è¿™æ˜¯å¯¹ä¸»è¯„è®º2çš„å›å¤ã€‚</div>
        <div style="font-size: 0.8em; color: #666;">ç”¨æˆ·5 Â· 2å°æ—¶å‰ | å›å¤</div>
      </div>
    </div>
  </div>
  
  <div style="color: #0066cc; cursor: pointer; margin-top: 5px;">åŠ è½½æ›´å¤šè¯„è®º...</div>
</div>

ä¸Šé¢çš„é‚£ç§ç»“æ„å®é™…ä¸Šå°±æ˜¯æŠŠåŸæ¥åµŒå¥—çš„è¯„è®ºè¿›è¡Œæ‰“å¹³ï¼ŒåŸæ¥çš„ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼ˆè¿™ä¸ªastroä¸»é¢˜å±…ç„¶æ²¡å‘è§£æmermaidğŸ˜…ï¼‰

```text
åŸå§‹å¸–å­
â”‚
â”œâ”€ ä¸»è¯„è®º 1
â”‚  â”œâ”€ å›å¤ 1.1
â”‚  â”œâ”€ å›å¤ 1.2
â”‚  â””â”€ å›å¤ 1.3
â”‚
â”œâ”€ ä¸»è¯„è®º 2
â”‚  â”œâ”€ å›å¤ 2.1
â”‚  â””â”€ å›å¤ 2.2
â”‚
â””â”€ ä¸»è¯„è®º 3
   â”œâ”€ å›å¤ 3.1
   â”œâ”€â”œâ”€ å›å¤ 3.1 çš„ 3.1.1çš„è¯„è®º
   â””â”€ å›å¤ 3.2
```

é€šè¿‡å¦‚ä¸Šçš„ç»“æ„å…¶å®å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥è¿™æ˜¯ä¸ªæ ‘å½¢ç»“æ„ï¼Œè€ŒäºŒçº§å›å¤çš„æ˜¾ç¤ºå½¢å¼å®é™…ä¸Šæ˜¯å¦‚ä¸‹çš„ç»“æ„

```text
åŸå§‹å¸–å­
â”‚
â”œâ”€ ä¸»è¯„è®º 1
â”‚  â”œâ”€ å›å¤ 1.1
â”‚  â”œâ”€ å›å¤ 1.2
â”‚  â””â”€ å›å¤ 1.3
â”‚
â”œâ”€ ä¸»è¯„è®º 2
â”‚  â”œâ”€ å›å¤ 2.1
â”‚  â””â”€ å›å¤ 2.2
â”‚
â””â”€ ä¸»è¯„è®º 3
   â”œâ”€ å›å¤ 3.1
   â”œâ”€ å›å¤ 3.1 çš„ 3.1.1çš„è¯„è®º
   â””â”€ å›å¤ 3.2

```

é€šè¿‡ä¸Šé¢çš„ç»“æ„å…¶å®å¾ˆæ˜æ˜¾çš„å¯ä»¥çœ‹å‡ºï¼Œæ‰€è°“çš„äºŒçº§å›å¤å®é™…ä¸Šå°±æ˜¯æ‰“å¹³ä¹‹åçš„åµŒå¥—å›å¤ï¼Œå°†åŸæ¥çš„å›å¤çš„åµŒå¥—å…³ç³»æ‰“å¹³ï¼Œé€šè¿‡å…¶ä»–å±æ€§å¸çº³äº‹è¯„è®ºä¹‹é—´çš„åµŒå¥—å…³ç³»ï¼Œå…³äºä»€ä¹ˆæ‰“å¹³å¯ä»¥æŸ¥çœ‹reactçš„å®˜æ–¹æ–‡æ¡£[é€‰æ‹©Stateç»“æ„](https://zh-hans.react.dev/learn/choosing-the-state-structure)åœ¨è¿™ç¯‡æ–‡ç« çš„æœ€åéå¸¸æ¸…æ™°çš„è¯´æ˜äº†ä»€ä¹ˆæ˜¯æ•°æ®çš„æ‰“å¹³ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æ‰å¹³åŒ–ã€‚

é‚£ä¹ˆæ€è·¯å…¶å®å°±å·²ç»å¾ˆæ¸…æ™°äº†ï¼ŒæŸ¥è¯¢æ‰€æœ‰è¯„è®ºçš„æ—¶å€™é€šè¿‡é€’å½’æŸ¥è¯¢æŸ¥è¯¢åˆ°æ‰€æœ‰è¯„è®ºä¸å›å¤ï¼Œä¹‹åå¾ªç¯å°†æŸ¥è¯¢å°è£…å¥½çš„ç»“æ„è¿›è¡Œæ‰“å¹³å³å¯ï¼Œå®ä½“ç±»å¦‚ä¸‹ï¼Œ

```java
public class Comment {
    private String id;
    private String comment;
    private String author;
    private String date;
    private int likes;
    private int dislikes;
    private int replies;
    private List<Reply> replyList;

}

public class Reply {
    private String id;
    private String reply;
    private String author;
    private String date;
    private String commentId;
    private int likes;
    private int dislikes;
    private String parentId;
    private String parentName;
    private List<Reply> replyList;
}
```

ä»¥ä¸Šå°±æ˜¯å®ä½“ç±»ï¼Œä¸‹é¢æ˜¯è¯„è®ºçš„ä¸¤å¼ è¡¨ï¼Œåˆ†ä¸ºè¯„è®ºè¡¨å’Œå›å¤è¡¨

```sql
CREATE TABLE `comments` (
  `id` varchar(36) NOT NULL,
  `comment` text NOT NULL,
  `author` varchar(100) NOT NULL,
  `date` date NOT NULL,
  `likes` int DEFAULT '0',
  `dislikes` int DEFAULT '0',
  `replies` int DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci

CREATE TABLE `replies` (
  `id` varchar(36) NOT NULL,
  `reply` text NOT NULL,
  `author` varchar(100) NOT NULL,
  `date` date NOT NULL,
  `comment_id` varchar(36) NOT NULL,
  `likes` int DEFAULT '0',
  `dislikes` int DEFAULT '0',
  `parent_id` varchar(255) DEFAULT NULL,
  `parent_name` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `comment_id` (`comment_id`),
  CONSTRAINT `replies_ibfk_1` FOREIGN KEY (`comment_id`) REFERENCES `comments` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
```

Mapperæ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.comment.mapper.CommentMapper">


    <resultMap type="com.comment.entity.Comment" id="comment">
        <result column="id" property="id"></result>
        <result column="comment" property="comment" />
        <result column="author" property="author" />
        <result column="date" property="date" />
        <result column="likes" property="likes" />
        <result column="dislikes" property="dislikes" />
        <result column="replies" property="replies" />
        <collection property="replyList" ofType="com.comment.entity.Reply" select="com.comment.mapper.CommentMapper.getReplies" column="id">
        </collection>
    </resultMap>


    <resultMap id="reply" type="com.comment.entity.Reply">
        <result column="id" property="id"></result>
        <result column="comment_id" property="commentId" />
        <result column="reply" property="reply" />
        <result column="author" property="author" />
        <result column="date" property="date" />
        <result column="likes" property="likes" />
        <result column="dislikes" property="dislikes" />
        <result column="parent_id" property="parentId" />
        <result column="parent_name" property="parentName" />
        <collection property="replyList" ofType="com.comment.entity.Reply" select="com.comment.mapper.CommentMapper.getRepliesByCommentId" column="id">
        </collection>
    </resultMap>

    <select id="getComments" resultMap="comment"> SELECT * FROM comments </select>

    <select id="getReplies" resultMap="reply">
        SELECT * FROM replies WHERE
        comment_id = #{commentId} and parent_id is null
    </select>
    <select id="getRepliesByCommentId" resultMap="reply">
        SELECT * FROM replies r  WHERE r.parent_id = #{id}
    </select>

</mapper>
```

ä¸Šé¢å°±æ˜¯mapperæ–‡ä»¶,ä¸»è¦æ˜¯æ˜¯ç”¨é€’å½’æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„ç»“æœè§£ææˆjsonå¦‚ä¸‹

```json
[
  {
    "id": "c001",
    "comment": "è¿™ç¯‡æ–‡ç« éå¸¸æœ‰è¶£ï¼Œè®©æˆ‘å­¦åˆ°äº†å¾ˆå¤š!",
    "author": "å¼ ä¸‰",
    "date": "2024-09-13",
    "likes": 15,
    "dislikes": 2,
    "replies": 2,
    "replyList": [
      {
        "id": "r001",
        "reply": "æˆ‘å®Œå…¨åŒæ„ä½ çš„è§‚ç‚¹ï¼Œè¿™ç¯‡æ–‡ç« ç¡®å®å¾ˆæ£’!",
        "author": "å°æ˜",
        "date": "2024-09-13",
        "commentId": "c001",
        "likes": 5,
        "dislikes": 0,
        "parentId": null,
        "parentName": null,
        "replyList": [
          {
            "id": "r008",
            "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
            "author": "å°èµµ",
            "date": "2024-09-13",
            "commentId": "c001",
            "likes": 4,
            "dislikes": 0,
            "parentId": "r001",
            "parentName": "å°æ˜",
            "replyList": []
          }
        ]
      },
      {
        "id": "r002",
        "reply": "èƒ½å…·ä½“è¯´è¯´ä½ å­¦åˆ°äº†ä»€ä¹ˆå—ï¼Ÿæˆ‘å¾ˆæ„Ÿå…´è¶£ã€‚",
        "author": "å°çº¢",
        "date": "2024-09-14",
        "commentId": "c001",
        "likes": 3,
        "dislikes": 1,
        "parentId": null,
        "parentName": null,
        "replyList": [
          {
            "id": "r009",
            "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
            "author": "å°ç‹",
            "date": "2024-09-16",
            "commentId": "c001",
            "likes": 5,
            "dislikes": 0,
            "parentId": "r002",
            "parentName": "å°çº¢",
            "replyList": []
          }
        ]
      }
    ]
  },
  {
    "id": "c002",
    "comment": "æˆ‘å¯¹è¿™ä¸ªè¯é¢˜æœ‰ä¸åŒçš„çœ‹æ³•ï¼Œä½œè€…çš„è®ºç‚¹ä¸å¤Ÿæœ‰è¯´æœåŠ›ã€‚",
    "author": "æå››",
    "date": "2024-09-14",
    "likes": 8,
    "dislikes": 5,
    "replies": 1,
    "replyList": [
      {
        "id": "r003",
        "reply": "ä½ èƒ½è¯¦ç»†è§£é‡Šä¸€ä¸‹ä½ çš„ä¸åŒçœ‹æ³•å—ï¼Ÿæˆ‘å¾ˆæƒ³å¬å¬ã€‚",
        "author": "å°æ",
        "date": "2024-09-14",
        "commentId": "c002",
        "likes": 4,
        "dislikes": 2,
        "parentId": null,
        "parentName": null,
        "replyList": [
          {
            "id": "r010",
            "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
            "author": "å°èµµ",
            "date": "2024-09-16",
            "commentId": "c002",
            "likes": 3,
            "dislikes": 0,
            "parentId": "r003",
            "parentName": "å°æ",
            "replyList": []
          }
        ]
      }
    ]
  },
  {
    "id": "c003",
    "comment": "æ–‡ç« å†™å¾—å¾ˆå¥½ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦å®Œå–„ã€‚",
    "author": "ç‹äº”",
    "date": "2024-09-15",
    "likes": 12,
    "dislikes": 1,
    "replies": 3,
    "replyList": [
      {
        "id": "r004",
        "reply": "æˆ‘è§‰å¾—ä½œè€…åœ¨ç¬¬ä¸‰æ®µçš„è®ºè¿°ç‰¹åˆ«ç²¾å½©ã€‚",
        "author": "å°å¼ ",
        "date": "2024-09-15",
        "commentId": "c003",
        "likes": 6,
        "dislikes": 0,
        "parentId": null,
        "parentName": null,
        "replyList": []
      },
      {
        "id": "r005",
        "reply": "ç¡®å®ï¼Œå¦‚æœèƒ½åŠ ä¸Šä¸€äº›å®é™…æ¡ˆä¾‹ä¼šæ›´å¥½ã€‚",
        "author": "å°ç‹",
        "date": "2024-09-16",
        "commentId": "c003",
        "likes": 4,
        "dislikes": 1,
        "parentId": null,
        "parentName": null,
        "replyList": []
      },
      {
        "id": "r006",
        "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
        "author": "å°èµµ",
        "date": "2024-09-16",
        "commentId": "c003",
        "likes": 3,
        "dislikes": 0,
        "parentId": null,
        "parentName": null,
        "replyList": []
      },
      {
        "id": "r007",
        "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
        "author": "å°å¼ ",
        "date": "2024-09-13",
        "commentId": "c003",
        "likes": 3,
        "dislikes": 0,
        "parentId": null,
        "parentName": null,
        "replyList": [
          {
            "id": "r011",
            "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
            "author": "å°èµµ",
            "date": "2024-09-16",
            "commentId": "c003",
            "likes": 1,
            "dislikes": 0,
            "parentId": "r007",
            "parentName": "å°å¼ ",
            "replyList": [
              {
                "id": "r012",
                "reply": "æˆ‘å»ºè®®ä½œè€…å¯ä»¥åœ¨ç»“è®ºéƒ¨åˆ†åšè¿›ä¸€æ­¥çš„é˜è¿°ã€‚",
                "author": "å°èµµ",
                "date": "2024-09-16",
                "commentId": "c003",
                "likes": 1,
                "dislikes": 0,
                "parentId": "r011",
                "parentName": "å°èµµ",
                "replyList": []
              }
            ]
          }
        ]
      }
    ]
  }
]
```
